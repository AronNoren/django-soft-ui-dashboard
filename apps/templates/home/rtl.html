{% extends 'layouts/base.html' %}

{% block title %} Billing {% endblock title %}

<!-- Specific CSS goes HERE -->
{% block stylesheets %}
{% endblock stylesheets %}

{% block content %}
 <form id="api-form">
  <label for="api-key">API Key:</label><br>
  <input type="text" id="api-key" name="api-key"><br>
  <label for="api-secret">API Secret:</label><br>
  <input type="text" id="api-secret" name="api-secret"><br>
  <input type="submit" value="Submit">
</form>

      {% include "includes/footer.html" %}

  </div>
{% endblock content %}

{% block javascripts %}
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
<script>
document.getElementById('api-form').addEventListener('submit', async function(event) {
  event.preventDefault(); // Prevent the form from being submitted normally
  
  var apiKey = document.getElementById('api-key').value;
  var apiSecret = document.getElementById('api-secret').value;

  var symbol = 'BTCUSDT'; // The token pair to buy
  var side = 'BUY';
  var type = 'MARKET';
  var quantity = 1; // The amount to buy

  // Build the query parameters
  var params = {
    symbol: symbol,
    side: side,
    type: type,
    quantity: quantity,
    timestamp: Date.now(),
    recvWindow: 5000 // Specify your own value here
  };
  
  var query = new URLSearchParams(params).toString();

  // Sign the query parameters with your API secret
  var signature = CryptoJS.HmacSHA256(query, apiSecret).toString(CryptoJS.enc.Hex);

  // Add the signature to the query parameters
  params.signature = signature;
  
  try {
    let response = await axios.post('https://api.binance.com/api/v3/order', params, {
      headers: {
        'X-MBX-APIKEY': apiKey
      }
    });
    console.log('Order placed successfully:', response.data);
  } catch(error) {
    console.error('Error placing order:', error);
  }
});
</script>
{% endblock javascripts %}
