{% extends 'layouts/base.html' %}

{% block title %} Chat with AI {% endblock title %}

<!-- Specific CSS goes HERE -->
{% block stylesheets %}
{% endblock stylesheets %}

{% block content %}

<div class="container-fluid py-4">
    <div id="chat"></div>

    <form id="chatForm">
        {% csrf_token %}
        <input id="userInput" type="text">
        <button type="submit">Send</button>
    </form>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        $('#chatForm').on('submit', function(e) {
            e.preventDefault();

            let userMessage = $('#userInput').val();
            $('#chat').append(`<p>You: ${userMessage}</p>`);

            $.ajax({
                url: '{% url "chat" %}',
                method: 'POST',
                headers: { "X-CSRFToken": '{{ csrf_token }}' },
                data: { message: userMessage },
                success: function(data) {
                    $('#chat').append(`<p>AI: ${data.reply}</p>`);
                },
                error: function(err) {
                    console.error(err);
                    $('#chat').append(`<p>AI: I'm sorry, I couldn't understand that.</p>`);
                }
            });

            $('#userInput').val('');
        });
    </script>
    
    {% include "includes/footer.html" %}
</div>

{% endblock content %}

<!-- Specific JS goes HERE --> 
{% block javascripts %}
{% endblock javascripts %}
